<form [formGroup]=impuntuacionPresupuestal>
    <h6 class="text-white bg-primary d-inline-block p-2 px-4 rounded">
        Imputación Presupuestal
    </h6>
    <div class="row">
        <div class="col-md-10">
            <button #btnHistorial class="btn btn-primary-700 w-100" type="button" data-toggle="collapse"
                data-target="#collapseHistorialOrdenes" aria-expanded="false" aria-controls="collapseHistorialOrdenes"
                (click)="mostrarOcultarHistoria(btnHistorial.getAttribute('aria-expanded'))">
                Historial de órdenes de pago
            </button>
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary text-white w-100" type="button" data-toggle="collapse"
                data-target="#collapseHistorialOrdenes" aria-expanded="false" aria-controls="collapseHistorialOrdenes"
                (click)="mostrarOcultarHistoria(btnHistorial.getAttribute('aria-expanded'))">
                <i class="fas {{mostrarOcultarIcono}}"></i>
                {{mostrarOcultar}}
            </button>
        </div>
    </div>
    <div class="" id="collapseHistorialOrdenes">
        <div class="container col-md-12">
            <ngx-general-table [config]="configTableHistorial" [datos]="datosTableHistorial"></ngx-general-table>
        </div>
    </div>
    <div class="row border-top border-primary mx-1 my-3"></div>
    <div class="row">
        <div class="col-md-3 form-group">
            <label for="disponibilidad">Disponibilidad</label>
            <input type="text" class="form-control" formControlName="disponibilidad" [value]="cpd" disabled>
        </div>
        <div class="col-md-3 form-group">
            <label for="registro">Registro</label>
            <mat-select class="form-control" placeholder="Seleccione..." formControlName="crp" [class.is-invalid]="isInvalid('crp')" (selectionChange)="fijarCdp()">
                <cdk-virtual-scroll-viewport itemSize="2" minBufferPx="100" maxBufferPx="200" class="vs-viewport-corto">
                    <mat-option *cdkVirtualFor="let rp of rps" [value]="rp">
                        {{rp.Consecutivo}}
                    </mat-option>
                </cdk-virtual-scroll-viewport>
            </mat-select>
        </div>
        <div class="col-md-6 form-group">
            <label for="codigo">Código</label>
            <mat-select class="form-control" placeholder="Seleccione..." formControlName="codigo" [class.is-invalid]="isInvalid('codigo')" (selectionChange)="nombreRubro()">
                <cdk-virtual-scroll-viewport itemSize="2" minBufferPx="100" maxBufferPx="200" class="vs-viewport-corto">
                    <mat-option *cdkVirtualFor="let rubroCrp of rubrosCrp" [value]="rubroCrp">
                        {{rubroCrp.FatherInfo._id}}
                    </mat-option>
                </cdk-virtual-scroll-viewport>
            </mat-select>
        </div>
    </div>
    <div class="row">
        <div class="col-md-8 form-group">
            <label for="nombre">Nombre</label>
            <input type="text" class="form-control" formControlName="nombre" [value]="nombre" disabled>
        </div>
        <div class="col-md-4 form-group">
            <label for="valorAplicacion">Valor Aplicación (Gasto)</label>
            <input currencyMask class="form-control" id="valorAplicacion" formControlName="valor">
        </div>
    </div>
    <div class="row justify-content-end">
        <div class="col-md-2">
            <button class="btn btn-primary text-white w-100" type="button" (click)="agregar()">
                <i class="fas fa-plus"></i> Agregar
            </button>
        </div>
    </div>
    <div id="tablaImputacion" class="container py-2 px-0">
        <ngx-general-table [config]="configTableImpuntuacion" [datos]="datosTableImputacion"></ngx-general-table>
    </div>
    <div class="row form-group justify-content-md-center">
        <div class="col-md-2 d-flex align-items-center"><label class="m-0 ml-auto" for="valorTotal">Valor Total</label>
        </div>
        <div class="col-md-4">
            <input class="form-control" id="valorTotal" disabled value="{{totalGasto()|currency}}">
        </div>
    </div>
    <ng-template #eliminarModal let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Borrar</h4>
            <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            ¿Desea borrar el registro?
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancelar</button>
            <button type="button" class="btn btn-danger" (click)="modal.close(true)">Borrar</button>
        </div>
    </ng-template>
    <ng-template #fuentesFinanciamientoModal let-modal>
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Fuentes de financiamiento</h4>
            <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <ngx-general-table [config]="configTableFuentes" [datos]="datosTableFuentes"></ngx-general-table>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="modal.close()">Cerrar</button>
        </div>
    </ng-template>

    <div class="row justify-content-between">
        <div class="col-md-3">
            <button mat-button matStepperPrevious class="btn btn-primary text-white">Anterior</button>
        </div>
        <div class="col-md-3 text-right">
            <button mat-button matStepperNext type="submit" class="btn btn-success" (click)="cargarImputacion()">
                Siguiente
            </button>
        </div>
    </div>
</form>